{% comment %}
  This section is used in the search template to render search results for
  products, articles, and pages.

  https://shopify.dev/docs/storefronts/themes/architecture/templates/search
{% endcomment %}

{{ 'component-search.css' | asset_url | stylesheet_tag }}
{{ 'component-custom-collection-carousel.css' | asset_url | stylesheet_tag }}
<script src="{{ 'component-custom-quick-add.js' | asset_url }}" defer></script>
{{ 'component-custom-collection-carousel.css' | asset_url | stylesheet_tag }}

<section class="search-grid section-padding--lg-bottom">
  <div class="container-xl g-4">
    <h1 class="search-grid__title heading-style-h2">{{ 'search.title' | t }}</h1>

    <form action="{{ routes.search_url }}" method="get" role="search">
      <div
        class="custom-input custom-input--search"
        style="--custom-input-icon: url('{{ 'icon-input-search.svg' | asset_url }}');"
      >
        <label class="custom-input__label" for="SearchInput">{{ 'search.placeholder' | t }}</label>
        <input
          class="custom-input__field"
          id="SearchInput"
          type="search"
          size="50"
          name="q"
          value="{{ search.terms | escape }}"
          placeholder="{{ 'search.placeholder' | t }}"
        >
        <button class="custom-input__icon-button" type="submit" aria-label="{{ 'search.submit' | t }}"></button>
      </div>
    </form>

{% if search.performed %}
  {% if search.results_count == 0 %}
    <p>{{ 'search.no_results_html' | t: terms: search.terms }}</p>
  {% else %}
    <p>{{ 'search.results_for_html' | t: terms: search.terms, count: search.results_count }}</p>

    <div class="search-results">
      {% paginate search.results by 20 %}
        {% # Search result items may be an article, a page, or a product. %}
        {% for result in search.results %}
          {% if result.object_type == 'product' %}
            {% assign product_result = result %}
            {% assign color_index = nil %}
            {% assign size_index = nil %}
            {% assign color_option = nil %}
            {% for option in product_result.options_with_values %}
              {% assign option_name = option.name | downcase %}
              {% if option_name contains 'color' or option_name contains 'colour' or option_name contains 'couleur' %}
                {% assign color_index = forloop.index0 %}
                {% assign color_option = option %}
              {% endif %}
              {% if option_name contains 'size' or option_name contains 'taille' %}
                {% assign size_index = forloop.index0 %}
              {% endif %}
            {% endfor %}

            {% if color_index != nil and color_option != nil %}
              {% for color_value in color_option.values %}
                {% case color_index %}
                  {% when 0 %}
                    {% assign color_variants = product_result.variants | where: 'option1', color_value %}
                  {% when 1 %}
                    {% assign color_variants = product_result.variants | where: 'option2', color_value %}
                  {% when 2 %}
                    {% assign color_variants = product_result.variants | where: 'option3', color_value %}
                {% endcase %}
                {% render 'custom-variant-color-card',
                  product: product_result,
                  variants: color_variants,
                  color_value: color_value,
                  color_index: color_index,
                  size_index: size_index
                %}
              {% endfor %}
            {% else %}
              {% render 'custom-variant-color-card',
                product: product_result,
                variants: product_result.variants,
                color_value: '',
                color_index: -1,
                size_index: size_index
              %}
            {% endif %}
          {% endif %}
        {% endfor %}

        {{ paginate | default_pagination }}
      {% endpaginate %}
    </div>
  {% endif %}
  {% endif %}
  </div>
</section>

{% schema %}
{
  "name": "t:general.search",
  "settings": []
}
{% endschema %}
